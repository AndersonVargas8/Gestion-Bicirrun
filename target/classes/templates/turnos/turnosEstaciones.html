<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnos programados</title>

    <link rel="icon" type="image/x-icon" href="/img/favicon.png" th:href="@{/img/favicon.png}" />

    <!--JQUERY-->
    <div th:replace="includes.html::jquery"></div>

    <!--BOOTSTRAP-->
    <div th:replace="includes.html::bootstrap"></div>

    <!--FONT AWESOME-->
    <div th:replace="includes.html::fontawesome"></div>

    <!--CSS-->
    <link rel="stylesheet" href="../../static/css/turnos.css" th:href="@{/css/turnos.css}" />
    <link rel="stylesheet" href="../../static/css/turnosEstaciones.css" th:href="@{/css/turnosEstaciones.css}" />
</head>

<body>

    <!--NavBar-->
    <div th:include="navbar.html" th:remove="tag"></div>

    <div class="d-flex" id="wrapper">
        <!-- Sidebar-->
        <div class="border-end bg-white" id="sidebar-wrapper">
            <div class="list-group list-group-flush">
                <div class="d-flex justify-content-center mb-4" th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
                    <button type="button" class="btn btn-outline-success mb-2 crear w-75" data-bs-toggle="modal"
                        data-bs-target="#modalFormTurnos" onclick="resetForm()">
                        <span class="fa-solid fa-calendar-plus"></span>&nbsp;Nuevo Turno
                    </button>
                </div>
                <div class="calendario" id="calendario">
                </div>
            </div>
        </div>

        <!-- Page content wrapper-->
        <div id="page-content-wrapper">

            <!-- Top navigation-->
            <nav class="navbar navbar-expand-lg navbar-light border-bottom" id="cabecera">
                <div class="container-fluid">
                    <button id="sidebarToggle" class="navbar-toggler" type="button">
                        <span class="navbar-toggler-icon text-dark"></span>
                    </button>
                    <i class="fa-solid fa-angle-left flecha" id="diaAtras"></i>
                    <h5 class="header-dia" id="header-dia">dd de MMMM del aaaa</h5>
                    <i class="fa-solid fa-angle-right flecha" id="diaAdelante"></i>
                </div>
            </nav>

            <!-- Page content-->
            <div class="container-fluid">
                <div class="overflow-auto">
                    <div id="contenido" th:fragment="contenido">
                        <div class="accordion mt-3 mb-3" id="accordionEstaciones">
                            <div class="accordion-item" th:each="estacion,iStat: ${turnos.estaciones}">
                                <h2 class="accordion-header" th:id="${'heading'+estacion.id}">
                                    <button
                                        th:class="${(iStat.count == 1) ? 'accordion-button' : 'accordion-button collapsed'}"
                                        type="button" data-bs-toggle="collapse"
                                        th:data-bs-target="${'#collapse'+estacion.id}" aria-expanded="true"
                                        th:aria-controls="${'collapse'+estacion.id}">
                                        <div class="d-block text-center w-100" th:text="${estacion.nombre}">Nombre
                                            estación
                                        </div>
                                    </button>
                                </h2>
                                <div th:id="${'collapse'+estacion.id}" th:class="${(iStat.count == 1) ? 'accordion-collapse collapse
                            show' : 'accordion-collapse collapse'}" aria-labelledby="${'heading'+estacion.id}"
                                    data-bs-parent="#accordionEstaciones">
                                    <div class="accordion-body p-2">
                                        <div class="header-estacion">
                                            <div>HORARIO</div>
                                            <div>ESTUDIANTE</div>
                                            <div>OBSERVACIONES</div>
                                            <div>ESTADO</div>
                                        </div>
                                        <div class="horario" th:each="horario: ${estacion.horarios}">
                                            <div th:each="turno: ${horario.turnos}" th:remove="tag">
                                                <div class="turno" th:if="${turno != null}">
                                                    <div th:text="${turno.horario}">--:-- - --:-- </div>
                                                    <div th:text="${turno.estudiante}">Estudiante</div>
                                                    <div>
                                                        <div class="form-floating">
                                                            <textarea class="form-control" id="obs"
                                                                th:value="${turno.observaciones}"
                                                                th:text="${turno.observaciones}"
                                                                th:onchange="cambiarObservacion([[${turno.id}]],this)">Observaciones</textarea>
                                                            <label for="obs">Observaciones</label>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div th:class="${(turno.idEstado == 3) ? 'alert alert-danger' : ((turno.idEstado == 2) ? 'alert alert-success' : 'alert alert-info')}"
                                                            th:text="${turno.estado}"
                                                            th:onclick="cambiarEstado([[${turno.id}]],[[${turno.idEstado}]])">
                                                            Estado</div>
                                                    </div>
                                                    <div class="acciones" th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
                                                        <i class="fa-solid fa-trash" title="Eliminar turno"
                                                            th:onclick="eliminarTurno([[${turno.id}]])"></i>
                                                        <i class="fa-solid fa-pen-to-square" title="Editar turno"
                                                            th:onclick="editarTurno([[${turno}]])"></i>
                                                    </div>
                                                </div>
                                                <div class="turnoDisponible" title="Agregar turno"
                                                    th:if="${turno == null}"
                                                    th:onclick="crearTurno([[${estacion.id}]],[[${horario.id}]])">
                                                    <div th:text="${horario.descripcion}">--:-- - --:-- </div>
                                                    <div><i>Disponible</i></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--Formulario-->
            <div class="modal fade" tabindex="-1" role="dialog" id="modalFormTurnos" th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
                <div class="modal-dialog modal-lg d-flex justify-content-center" role="document">
                    <div class="modal-content w-75">
                        <div class="modal-header modal-form-header">
                            <h5 class="modal-title">Programar nuevo turno</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <!--Inputs-->
                        <div th:include="turnos/formularioTurnos.html" class="modal-body p-4 d-flex
                    justify-content-center">

                        </div>
                    </div>
                </div>
            </div>
            <!--MODAL ESTADOS-->
            <div class="modal fade" id="seleccionarEstado" data-bs-backdrop="static" data-bs-keyboard="false"
                tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-0">
                        <div class="modal-header modal-form-header">
                            <h5 class="modal-title" id="staticBackdropLabel">Cambiar estado</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div id="modalBodyEstados" class="modal-body d-block text-center">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary border-0" data-bs-dismiss="modal"
                                id="cancelar">Cancelar</button>
                            <button type="button" class="btn guardar border-0" value="Guardar"
                                id="guardar">Guardar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!--MODAL ELIMINACIÓN-->
            <div th:replace="confirmarEliminacion.html"></div>

            <!--DATEPICKER-->
            <div th:replace="includes.html::datepicker" ></div>

            <!--DSELECT-->
            <div th:replace="includes.html::dselect"></div>

            <!--TOASTR-->
            <div th:replace="includes.html::toastr"></div>

            <!--JAVASCRIPT-->
            <script src="../../static/javascript/turnosEstaciones.js"
                th:src="@{/javascript/turnosEstaciones.js}"></script>
</body>

</html>